<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­£ç¯€è¬›ç¿’ è¦‹ç©ä½œæˆ (åœ¨æ ¡ç”Ÿç”¨)</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Modern & Stylish Overrides */
        :root {
            /* Palette Update: Emerald/Teal Theme to distinguish from Blue */
            --primary: #059669;
            --primary-light: #d1fae5;
            --primary-hover: #047857;
            --accent: #f59e0b;
            /* Amber for highlights */
            --bg-body: #f3f4f6;
            --bg-card: #ffffff;
            --text-main: #1f2937;
            --text-sub: #6b7280;
            --border: #e5e7eb;
            --radius-md: 12px;
            --radius-lg: 16px;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
        }

        .header {
            background: linear-gradient(135deg, #059669, #10b981);
            color: white;
            padding: 2rem 0;
            box-shadow: var(--shadow-md);
            margin-bottom: 30px;
        }

        .header h1 {
            font-weight: 700;
            letter-spacing: 0.05em;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .header-content {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header-content .icon-btn {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }

        .seasonal-header-badge {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(4px);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .icon-btn {
            border-color: rgba(255, 255, 255, 0.5);
            color: white;
        }

        .icon-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Card Styling */
        .config-panel,
        .estimate-panel .sticky-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: none;
            padding: 25px;
        }

        .form-group {
            margin-bottom: 35px;
        }

        h2 {
            font-size: 1.1rem;
            color: var(--text-main);
            border-bottom: none;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .step-num {
            background: var(--primary);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
        }

        /* Season Selector */
        .season-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }

        .season-option {
            flex: 1;
            position: relative;
        }

        .season-option input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .season-card {
            display: block;
            text-align: center;
            padding: 15px;
            background: white;
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: bold;
            color: var(--text-sub);
        }

        .season-option input:checked+.season-card {
            border-color: var(--primary);
            background: var(--primary-light);
            color: var(--primary);
            box-shadow: 0 0 0 2px var(--primary-light);
        }

        /* Stylish Inputs */
        .premium-select,
        .premium-input,
        .seasonal-table-input {
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
            background-color: #f9fafb;
        }

        .premium-select:focus,
        .premium-input:focus,
        .seasonal-table-input:focus {
            background-color: white;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
            outline: none;
        }

        /* Table Styling */
        .seasonal-table-container {
            background: white;
            border-radius: var(--radius-md);
            overflow: hidden;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
        }

        .seasonal-table {
            width: 100%;
        }

        .seasonal-table thead {
            background: #f9fafb;
            border-bottom: 1px solid var(--border);
        }

        .seasonal-table th {
            padding: 12px 15px;
            font-size: 0.85rem;
            color: var(--text-sub);
            font-weight: 600;
        }

        .seasonal-table td {
            padding: 10px 15px;
            border-bottom: 1px solid #f3f4f6;
        }

        .seasonal-table tr:last-child td {
            border-bottom: none;
        }

        .seasonal-table-input {
            width: 100%;
            border: 1px solid transparent;
            /* Invisible border by default */
            background: transparent;
            padding: 8px;
        }

        .seasonal-table-input:hover {
            background: #f9fafb;
        }

        .seasonal-table-input:focus {
            background: white;
            border-color: var(--primary);
        }

        /* Stepper Style */
        .stepper-compact {
            background: #f3f4f6;
            padding: 4px;
            border-radius: 20px;
            /* Pill shape */
            display: inline-flex;
            align-items: center;
        }

        .stepper-compact .stepper-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: white;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            border: none;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.1s;
        }

        .stepper-compact .stepper-btn:active {
            transform: scale(0.9);
        }

        .stepper-compact .stepper-val {
            background: transparent;
            border: none;
            width: 40px;
            text-align: center;
            font-weight: bold;
            font-size: 1rem;
            color: var(--text-main);
        }

        /* Summary Box */
        .tier-summary-box {
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
            border-radius: var(--radius-md);
            margin-top: 15px;
        }

        .tier-label {
            color: #065f46;
        }

        .tier-price {
            color: #059669;
        }

        /* Other Expenses List */
        .other-costs-list {
            margin-bottom: 15px;
        }

        .other-cost-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .other-cost-row input {
            flex: 1;
        }

        .other-cost-row input[type="number"] {
            flex: 0 0 120px;
            text-align: right;
        }

        /* TBD Checkbox */
        .tbd-option {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background: #fffbeb;
            border: 1px solid #fcd34d;
            border-radius: 8px;
            cursor: pointer;
        }

        .tbd-text {
            margin-left: 10px;
            font-size: 0.95rem;
            color: #92400e;
        }

        /* Estimate Panel */
        .estimate-panel .sticky-card {
            border-top: 5px solid var(--primary);
        }

        .total-section .grand-total {
            color: var(--primary);
        }

        .action-btn {
            background: linear-gradient(to right, var(--primary), #10b981);
            border-radius: 30px;
            box-shadow: 0 4px 6px rgba(5, 150, 105, 0.3);
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(5, 150, 105, 0.4);
        }

        /* Toggle Buttons (Doc Type) - Styled */
        .toggle-group {
            background: #f3f4f6;
            padding: 4px;
            border-radius: 30px;
            display: inline-flex;
            width: 100%;
        }

        .toggle-btn {
            flex: 1;
            border-radius: 25px;
            border: none;
            padding: 10px;
            background: transparent;
            color: var(--text-sub);
            font-weight: 600;
            transition: all 0.3s;
        }

        .toggle-btn.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Visibility Improvements based on feedback */
        .step-num {
            font-weight: 800 !important;
            font-size: 1.1rem !important;
            color: #ffffff !important;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
            width: 32px;
            height: 32px;
        }

        .action-btn {
            background-color: var(--primary) !important;
            color: #ffffff !important;
            font-weight: 700 !important;
            font-size: 1.2rem !important;
            padding: 18px !important;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            box-shadow: 0 4px 6px rgba(5, 150, 105, 0.3);
        }

        .helper-text {
            color: #374151 !important;
            /* Darker gray for better readability */
            font-weight: 500;
        }
    </style>
</head>

<body>

    <div class="app-container">
        <header class="header">
            <div class="header-content">
                <h1>åœ¨æ ¡ç”Ÿç”¨ å­£ç¯€è¬›ç¿’è¦‹ç©ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
                <button id="open-config-btn" class="icon-btn" title="æ•™å®¤æƒ…å ±è¨­å®š">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z">
                        </path>
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                    <span>è¨­å®š</span>
                </button>
            </div>
        </header>

        <main class="main-content">
            <!-- Left Column: Settings -->
            <section class="config-panel">

                <!-- Season Selector -->
                <div class="form-group">
                    <div class="season-selector" id="season-selector">
                        <label class="season-option">
                            <input type="radio" name="season" value="spring" checked>
                            <span class="season-card">ğŸŒ¸ æ˜¥æœŸè¬›ç¿’</span>
                        </label>
                        <label class="season-option">
                            <input type="radio" name="season" value="summer">
                            <span class="season-card">ğŸŒ» å¤æœŸè¬›ç¿’</span>
                        </label>
                        <label class="season-option">
                            <input type="radio" name="season" value="winter">
                            <span class="season-card">â„ï¸ å†¬æœŸè¬›ç¿’</span>
                        </label>
                    </div>
                </div>

                <!-- Document Type -->
                <div class="form-group">
                    <h2><span class="step-num">1</span> æ›¸é¡ãƒ»ç”Ÿå¾’æƒ…å ±</h2>
                    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <div style="flex:1;">
                            <label class="helper-text" style="display:block; margin-bottom:8px;">æ›¸é¡ç¨®åˆ¥</label>
                            <div class="toggle-group" id="doc-type-selector">
                                <button type="button" class="toggle-btn active" data-value="estimate">è¦‹ç©æ›¸</button>
                                <button type="button" class="toggle-btn" data-value="invoice">è«‹æ±‚æ›¸</button>
                            </div>
                        </div>
                        <div style="flex:1;">
                            <label class="helper-text" style="display:block; margin-bottom:8px;">å­¦å¹´</label>
                            <select id="grade-selector" class="premium-select" style="width:100%;">
                                <option value="elem45">å°å­¦ç”Ÿ (45åˆ†)</option>
                                <option value="elem80">å°å­¦ç”Ÿ (80åˆ†)</option>
                                <option value="middle12" selected>ä¸­å­¦1ãƒ»2å¹´ç”Ÿ</option>
                                <option value="middle3high12">ä¸­å­¦3å¹´ãƒ»é«˜æ ¡1ãƒ»2å¹´ç”Ÿ</option>
                                <option value="high3">é«˜æ ¡3å¹´ç”Ÿãƒ»æ—¢å’</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Seasonal Course Selection -->
                <div class="form-group">
                    <h2><span class="step-num">2</span> è¬›ç¿’å†…å®¹</h2>
                    <p class="helper-text" style="margin-bottom:15px; color:#6b7280;">ç§‘ç›®åã‚„è©³ç´°ã€ã‚³ãƒæ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>

                    <div class="seasonal-table-container">
                        <table class="seasonal-table" id="seasonal-table">
                            <thead>
                                <tr>
                                    <th style="width: 25%;">ç§‘ç›®</th>
                                    <th style="width: 25%;">è©³ç´° (ç´š/ç§‘ç›®ç­‰)</th>
                                    <th style="width: 22%; text-align:center;">1:2 ã‚³ãƒ</th>
                                    <th style="width: 22%; text-align:center;">1:1 ã‚³ãƒ</th>
                                    <th style="width: 30px;"></th>
                                </tr>
                            </thead>
                            <tbody id="seasonal-tbody">
                                <!-- JS Generated Rows -->
                            </tbody>
                        </table>
                        <button type="button" id="add-subject-btn" class="secondary-btn"
                            style="width: 100%; border-top: 1px solid var(--border); border-radius: 0; color: var(--primary); padding:10px;">
                            + ç§‘ç›®ã‚’è¿½åŠ ã™ã‚‹
                        </button>
                    </div>

                    <div class="tier-summary-box">
                        <div class="tier-row">
                            <div class="tier-label">å€‹åˆ¥ 1:2</div>
                            <div class="tier-val"><strong id="seasonal-total-slots-1-2">0</strong> ã‚³ãƒ</div>
                            <div class="tier-price">@<strong id="seasonal-unit-price-1-2">-</strong> å††</div>
                        </div>
                        <div class="tier-row" style="border-left: 1px solid #a7f3d0; border-bottom:none;">
                            <div class="tier-label">å€‹åˆ¥ 1:1</div>
                            <div class="tier-val"><strong id="seasonal-total-slots-1-1">0</strong> ã‚³ãƒ</div>
                            <div class="tier-price">@<strong id="seasonal-unit-price-1-1">-</strong> å††</div>
                        </div>
                    </div>
                </div>

                <!-- Other Expenses -->
                <div class="form-group">
                    <h2><span class="step-num">3</span> ãã®ä»–çµŒè²»</h2>
                    <p class="helper-text" style="margin-bottom:15px;">æ•™æè²»ã‚„ãƒ†ã‚¹ãƒˆä»£ãªã©ã€è¿½åŠ ã®è²»ç”¨ãŒã‚ã‚Œã°å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>

                    <div id="other-costs-container" class="other-costs-list">
                        <!-- Dynamic list -->
                    </div>
                    <button type="button" id="add-cost-btn" class="secondary-btn small" style="margin-bottom:20px;">+
                        çµŒè²»ã‚’è¿½åŠ </button>

                    <label class="tbd-option">
                        <input type="checkbox" id="material-tbd-check">
                        <span class="tbd-text">æ•™æè²»ã¯æœªå®š (å¾Œæ—¥ç²¾ç®—ãªã©ã®å ´åˆ)</span>
                    </label>
                </div>

            </section>

            <!-- Right Column: Estimate -->
            <section class="estimate-panel">
                <div class="sticky-card">
                    <h2 style="justify-content:center;">æ¦‚ç®—ãŠè¦‹ç©ã‚Š</h2>

                    <div class="line-items" id="line-items">
                        <!-- Dynamic items -->
                    </div>

                    <div class="total-section">
                        <div class="total-row">
                            <span>è¬›ç¿’å—è¬›æ–™</span>
                            <span id="seasonal-tuition-display">0å††</span>
                        </div>
                        <div class="total-row">
                            <span>ãã®ä»–çµŒè²»</span>
                            <span id="other-fees-display">0å††</span>
                        </div>
                        <div class="total-row grand-total"
                            style="font-size: 1.5rem; justify-content:space-between; display:flex; margin-top:15px; border-top:2px dashed #ddd; padding-top:15px;">
                            <span>ã”è«‹æ±‚é‡‘é¡</span>
                            <span id="total-amount-display">0å††</span>
                        </div>
                    </div>

                    <div class="initial-cost-section"
                        style="margin-top:20px; background:#f9fafb; padding:15px; border-radius:8px;">
                        <h3 style="font-size:0.95rem; margin-bottom:10px;">ãŠæ”¯æ‰•ã„æœŸé™</h3>
                        <input type="date" id="transfer-deadline" class="premium-input" style="width:100%;">
                    </div>

                    <div class="client-info-box" style="margin-top:15px;">
                        <input type="text" id="student-name" placeholder="ç”Ÿå¾’æ°å" class="premium-input"
                            style="width:100%;">
                    </div>

                    <div style="margin-top:25px;">
                        <button class="action-btn" id="generate-btn" style="width:100%; padding:15px;">æ›¸é¡ã‚’ä½œæˆã™ã‚‹</button>
                    </div>
                </div>
            </section>
        </main>

        <!-- Printable Layout (Hidden on Screen) -->
        <div id="printable-estimate" class="printable-sheet">
            <div class="sheet-header">
                <div class="header-left">
                    <div class="title-block">
                        <h1 id="print-title">è¬›ç¿’è²» å¾¡è¦‹ç©æ›¸</h1>
                    </div>
                    <div class="meta-block">
                        <p>ç™ºè¡Œæ—¥: <span id="print-date"></span></p>
                        <p>No: <span id="estimate-id"></span></p>
                    </div>
                </div>
                <div class="header-right" id="print-company-info-container">
                    <!-- Company Info Injected Here -->
                </div>
            </div>

            <div class="recipient-section">
                <h2 id="print-student-name">______ æ§˜</h2>
                <p id="print-greeting">
                    ã„ã¤ã‚‚ã”åˆ©ç”¨ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚<br>
                    ä»¥ä¸‹ã®é€šã‚Šã€å­£ç¯€è¬›ç¿’ã®è²»ç”¨ã«ã¤ã„ã¦ã”æ¡ˆå†…ç”³ã—ä¸Šã’ã¾ã™ã€‚
                </p>
                <div id="print-message-box" style="margin-top:10px;">
                    <!-- Deadline etc -->
                </div>
            </div>

            <table class="estimate-table">
                <thead>
                    <tr>
                        <th>é …ç›®</th>
                        <th>å†…å®¹</th>
                        <th>å˜ä¾¡</th>
                        <th>å›æ•°</th>
                        <th>é‡‘é¡ (ç¨è¾¼)</th>
                    </tr>
                </thead>
                <tbody id="print-table-body">
                    <!-- Dynamic Rows -->
                </tbody>
                <tfoot>
                    <tr class="summary-row highlight">
                        <td colspan="3" style="text-align:right">åˆè¨ˆ</td>
                        <td id="print-total-count" style="text-align:center">0å›</td>
                        <td id="print-total-amount">0å††</td>
                    </tr>
                </tfoot>
            </table>

            <div class="remarks-section">
                <h3>å‚™è€ƒ</h3>
                <ul id="print-remarks">
                    <li>æœ¬è«‹æ±‚ã¯é€šå¸¸ã®æœˆè¬ã¨ã¯åˆ¥é€”ã®ã”è«‹æ±‚ã¨ãªã‚Šã¾ã™ã€‚</li>
                    <li>æ—¥ç¨‹å¤‰æ›´ã‚„ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã®è¦å®šã«ã¤ã„ã¦ã¯ã€åˆ¥é€”é…å¸ƒã®ã”æ¡ˆå†…ã‚’ã”ç¢ºèªãã ã•ã„ã€‚</li>
                    <li>ã”ä¸æ˜ãªç‚¹ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«æ•™å®¤ã¾ã§ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚</li>
                </ul>
            </div>

            <div class="footer-section">
                <div class="company-info">
                    <!-- Footer Info -->
                </div>
            </div>
        </div>
    </div>

    <!-- Configuration Modal (Reuse) -->
    <div id="config-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>æ•™å®¤æƒ…å ±è¨­å®š</h2>
                <button id="close-config-btn" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-section">
                    <label>ä¼šç¤¾ãƒ­ã‚´</label>
                    <div class="logo-upload-area">
                        <img id="logo-preview" src="" alt="ãƒ­ã‚´ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" class="logo-preview hidden">
                        <div class="upload-controls">
                            <input type="file" id="logo-input" accept="image/*">
                            <button id="logo-clear-btn" class="secondary-btn small hidden">å‰Šé™¤</button>
                        </div>
                    </div>
                </div>
                <div class="form-section">
                    <label>ä¼šç¤¾å / å±‹å·</label>
                    <input type="text" id="cfg-company" class="premium-input">
                </div>
                <div class="form-section">
                    <label>éƒµä¾¿ç•ªå·</label>
                    <input type="text" id="cfg-zip" class="premium-input">
                </div>
                <div class="form-section">
                    <label>ä½æ‰€</label>
                    <textarea id="cfg-address" class="premium-input" rows="2"></textarea>
                </div>
                <div class="form-section">
                    <label>é›»è©±ç•ªå·</label>
                    <input type="text" id="cfg-phone" class="premium-input">
                </div>
                <div class="form-section">
                    <label>ç™»éŒ²ç•ªå· (ã‚¤ãƒ³ãƒœã‚¤ã‚¹)</label>
                    <input type="text" id="cfg-invoice" class="premium-input">
                </div>
                <div class="form-section">
                    <label>æŒ¯è¾¼å…ˆå£åº§æƒ…å ±</label>
                    <textarea id="cfg-bank" class="premium-input" rows="3"></textarea>
                </div>
                <button id="save-config-btn" class="action-btn">ä¿å­˜ã—ã¦é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <script src="seasonal_script.js"></script>
</body>

</html>